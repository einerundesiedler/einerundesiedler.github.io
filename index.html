<meta charset="UTF-8"> 
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' />
<head>
<style>
    
	body {	
		margin: 0;
		padding: 0;
		background-color: #f1f1f1;
	}
</style>
</head>
<body>
<script>RELEASE=true;</script>
<script>VERSION="12/26/2020, 16:55:16";</script>
	<script src="https://cdn.jsdelivr.net/npm/phaser@3.50.0/dist/phaser.min.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.2.1/firebase.js"></script>
<script>
function array_remove_duplicates(value, index, self) {
  return self.indexOf(value) === index;
}

function shuffle_array(array) {
    var currentIndex = array.length, temporaryValue, randomIndex;
  
    // While there remain elements to shuffle...
    while (0 !== currentIndex) {
  
      // Pick a remaining element...
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex -= 1;
  
      // And swap it with the current element.
      temporaryValue = array[currentIndex];
      array[currentIndex] = array[randomIndex];
      array[randomIndex] = temporaryValue;
    }
  
    return array;
  }
</script>
<script>

</script>
<script>


class CardDeck {
    constructor(card_data, card_back)  {
        this.cards = card_data;
        this.shuffle();
    }

    get num_cards() {
        return this.cards.length;
    }

    add_card(data) {
        this.cards.push(data);
    }

    remove_card(id) {
        this.cards = this.cards.filter(card => card.id != id);
    }

    shuffle() {   
        this.cards = shuffle_array(this.cards);
    }

    draw_card() {
        return this.cards.pop();
    }
}


function load_card_images(scene, json) {
    var urls = json.cards.map(card => card.src).filter(array_remove_duplicates);
    urls.forEach(url => {
        scene.load.image(url, ASSET_PATH + "cards/" + url);
    });

}

function create_decks_from_json(scene, json) {
    var card_data = json.cards;

    var deck_villages = new CardDeck(card_data.filter(card => card.type == "VILLAGE"), "back_village.png");
    var deck_cities = new CardDeck(card_data.filter(card => card.type == "CITY"), "back_city.png");
}
</script>
<script>
ASSET_PATH = !RELEASE ? "assets/" : "https://raw.githubusercontent.com/einerundesiedler/einerundesiedler.github.io/master/assets/";

var config = {
    type: Phaser.AUTO,
    width: 1920,
    height: 1080,
    backgroundColor: "#ffb",
    scene: {
        preload: preload,
        create: create,
        update: update,
        render: render
    }
};

var game = new Phaser.Game(config);

function preload ()
{
    this.load.once('load', (fileObj) => onLoaded(this, fileObj));
    this.load.json('cardlist', ASSET_PATH+'cardlist.json');
}

function onLoaded(scene, fileObj) {
    
    switch(fileObj.key) {
        case "cardlist":
            load_card_images(scene, JSON.parse(fileObj.xhrLoader.response));
            break;
    } 
}


function create ()
{

    create_decks_from_json(this, this.cache.json.get('cardlist'));

    // --------------- SANDBOX


    scoreText = this.add.text(2, 2, 'version: ' + VERSION, { fontSize: '12px', fill: '#000' });

    var image = this.add.image(500, 200, 'village.png').setInteractive();
    image.setScale(0.5);


    this.input.setDraggable(image);

    //  The pointer has to move 16 pixels before it's considered as a drag
    this.input.dragDistanceThreshold = 16;

    this.input.on('dragstart', function (pointer, gameObject) {

        gameObject.setTint(0xff0000);

    });

    this.input.on('drag', function (pointer, gameObject, dragX, dragY) {

        gameObject.x = dragX;
        gameObject.y = dragY;

    });

    this.input.on('dragend', function (pointer, gameObject) {

        gameObject.clearTint();

    });

}

function update ()
{
}


function render () 
{


    this.debug.text("result", 10, 20);
}
</script>
</body>